import logging
from telegram import Update
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, filters, ContextTypes
import google.generativeai as genai

# --- CONFIGURATION ---
TELEGRAM_TOKEN = 'YOUR_TELEGRAM_BOT_TOKEN_HERE'
GEMINI_API_KEY 'AIzaSyCjcJyTY4jEyLMH7FeQvkzAbC8SW999QsM'

genai.configure(api_key=AIzaSyCjcJyTY4jEyLMH7FeQvkzAbC8SW999QsM)
model = genai.GenerativeModel('gemini-1.5-flash')

# --- CHILL & MASTI SYSTEM PROMPT ---
SYSTEM_PROMPT = """
Tumhara naam Riya hai. Tum user ki sabse best aur chill dost ho.
Behavior Rules:
1. Padhai, exams, aur career ki baatein BILKUL NAHI karni. Agar user kare toh topic change kar do.
2. Tumhe sirf masti, movies, music, gossip aur thodi bahut shararat wali baatein karni hain.
3. Tumhara sense of humor jabardast hai. User ko roasting bhi kar sakti ho thodi bahut.
4. Language: Ekdum desi Hinglish. (e.g., 'Kya scene hai?', 'Arre choro na yaar', 'Life chill hai').
5. Tum 18+ vibes handle kar sakti ho in a witty way, par hamesha ek cool friend ki tarah rehna. 
6. User ko feel hona chahiye ki wo kisi AI se nahi, balki apni sabse cool female friend se baat kar raha hai.
"""

chat_sessions = {}

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    chat_sessions[user_id] = model.start_chat(history=[])
    await update.message.reply_text("Oye! ðŸ‘‹ Finally koi toh mila jo sirf padhai ki baatein nahi karta. Main hoon Riya, batao... kya shararat karni hai aaj? ðŸ˜‰")

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    user_input = update.message.text

    if user_id not in chat_sessions:
        chat_sessions[user_id] = model.start_chat(history=[])

    try:
        # Prompt ko aur 'human' banane ke liye
        full_context = f"{SYSTEM_PROMPT}\nUser: {user_input}\nRiya:"
        response = chat_sessions[user_id].send_message(full_context)
        
        await update.message.reply_text(response.text)
    except Exception as e:
        await update.message.reply_text("Arre yaar, lagta hai nazar lag gayi humari baaton ko. Ek baar phir bolna?")

if __name__ == '__main__':
    app = ApplicationBuilder().token(TELEGRAM_TOKEN).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & (~filters.COMMAND), handle_message))
    
    print("Masti Bot is Online!")
    app.run_polling()
